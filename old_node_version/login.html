<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<script src="http://libs.baidu.com/jquery/2.0.0/jquery.min.js" type="text/javascript"></script>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap-theme.min.css"><script src="js/util.js"></script>
<script type="text/javascript">
$(document).ready(
	function()
	{
		//setTimeout("window.location.reload()", 2000);
		$("#host").focus().select();
		$('#login_btn').click(function(){
			var host = $('#host').val();
			setCookie('zkhost', host, 864000);
			var authtype = $('#auth_type').val()
			setCookie('zkauthtype', authtype, 864000);
			var authvalue = $('#auth_value').val()
			setCookie('zkauthval', authvalue);
			var ZooKeeper = require ("zookeeper");
			var zk = new ZooKeeper({connect:host,timeout:200000,debug_level:ZooKeeper.ZOO_LOG_LEVEL_DEBUG});
			zk.connect(function(err){
				if(err)
				{
					myalert('ZooKeeper connect failed, err='+err);
					return;
				}
				zk.a_get_children('/',0,function(rc,err,list){
					if(0!=rc)
					{
						myalert("List / after connect failed, err="+err);
						zk.close();
						zk = null;
						return;
					}
					window.location.href="main.html";
				});
			});
		});
		var ohost = getCookie('zkhost');
		if(!empty(ohost))
			$("#host").val(ohost);
		var oatype = getCookie('zkauthtype');
		if(!empty(oatype))
			setAuthType(oatype);
	}
);
function setAuthType(type)
{
	$('#auth_type').val(type);
	$('#type_select_btn>span').eq(0).text(type);
}
function myalert(text)
{
	$('#alert').text(text).fadeIn(500);
}
</script>
</head>
<body>
<div class="container-fluid">
	<div class="row">
		<div class="col-sm-3"></div>
		<div class="col-sm-6">
			<form role="form">
				<div class="form-group">
					<label for="host">Host</label>
					<input type="text" class="form-control" id="host" placeholder="e.g. 127.0.0.1:2181,192.168.0.15:2181"/>
				</div>
				<div class="form-group">
					<label for="host">Auth</label>
					<div class="input-group" role="group" aria-lable="...">
						<div class="input-group-btn" role="group" id="type_select">
							<button type="button" class="btn btn-info dropdown-toggle" data-toggle="dropdown" aria-expanded="false" id="type_select_btn"><span>world</span><span class="caret"></span></button>
							<ul class="dropdown-menu" role="menu" id="type_select_menu">
								<li><a href="javascript:setAuthType('world')">world</a></li>
								<li><a href="javascript:setAuthType('digest')">digest</a></li>
								<li><a href="javascript:setAuthType('ip')">ip</a></li>
							</ul>
							<input type="hidden" id="auth_type" value="world"/>
						</div>
						<input type="text" id="auth_value" class="form-control" placeholder="only for digest, e.g. user:password-digest"/>
					</div>
				</div>
				<div class="form-group">
					<button type="button" class="btn btn-primary form-control" id="login_btn">Login</button>
				</div>
				<div>
					<div class="alert alert-warning" role="alert" id="alert" style="display:none"></div>
				</div>
			</form>
		</div>
		<div class="col-sm-3"></div>
	</div>
</div>
</body>
</html>